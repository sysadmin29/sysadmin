- name: Show final AD-style replication summary
  set_fact:
    final_output: |
      Replication Summary Start Time: {{ lookup('pipe', 'date +"%Y-%m-%d %H:%M:%S"') }}

      Beginning data collection for replication summary, this may take awhile:
        .....

      Source DSA          largest delta    fails/total %%   error
      {% for row in combined_rows if row.startswith('Source') %}
      {% set parts = row.split() %}
      {% if parts|length >= 6 %}
       {{ "%-18s %-15s %-12s %-5s %-10s" | format(
            parts[1],
            parts[2],
            parts[3] ~ " " ~ parts[4] ~ " " ~ parts[5],
            parts[6],
            parts[7] if parts|length > 7 else ""
       ) }}
      {% endif %}
      {% endfor %}

      Destination DSA     largest delta    fails/total %%   error
      {% for row in combined_rows if row.startswith('Destination') %}
      {% set parts = row.split() %}
      {% if parts|length >= 6 %}
       {{ "%-18s %-15s %-12s %-5s %-10s" | format(
            parts[1],
            parts[2],
            parts[3] ~ " " ~ parts[4] ~ " " ~ parts[5],
            parts[6],
            parts[7] if parts|length > 7 else ""
       ) }}
      {% endif %}
      {% endfor %}